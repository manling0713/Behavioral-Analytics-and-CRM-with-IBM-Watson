---
title: "Customer final"
output: github_document
date: "2023-12-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## First Steps 

NOTE: Your data needs to be in the folder where your code is located!

The first Chunk of Code will always do 3 Things for us

1) Clear ALL Variables (to make sure nothing is "left over") and clear the      screen. 
2) Read in the data we want to use. In our case the file is called              "data.price.csv)"
3) Explore the data (what variables are in it and what are some basic           statistics for these variables)

```{r}

# Clear All Variables & Clear the Screen
rm(list=ls())
cat("\014")

# Read in the Data
df = read.csv("Final_new.csv")



# Explore the data
str(df)
summary(df)
```

## PREPARE DATA
 
In our case we have to create new variables: log(Units) and log(Prices)

```{r}

# Create log CLV
df$logCLV <- log(df$Customer.Lifetime.Value)

## Make a dummy variable 

df$Gender <- ifelse(df$Gender == 'M', 1, 0)
df$Marital.Status <- ifelse(df$Marital.Status == 'Married', 1, 0)

# Display the modified data frame
head(df)



```

## REGRESSION MODELS

1) Define y (Dependent Variable). For this example, Sales for Brand 1           (UNITS1) is used.

2) Define X (Independent Variables). For this example, OWN Marketing Activity    (PRICE1, FEAT1 and DISP1) is used

3) Run the Models. For example, a linear model where Sales for Brand 1          (UNITS1) are a function of Units1's Price (PRICE1), Feature (FEAT1), and     Display (DISP1)

```{r}

# Run the Regression (includes an INTERCEPT)

# Define TRAINING Data (i.e, using the FIRST 3000)
data.training <- df[1:7321,]
data.test <- df[7322:9134,]
head(data.training)

lm.linear   <- lm(Customer.Lifetime.Value  ~ ., data = data.training[, -c(1, 2, 4, 11, 37, 40)])
lm.semi_log <- lm(logCLV  ~ ., data = data.training[, -c(1, 2, 3, 4, 11, 37)])
lm.semi_log2 <- lm(logCLV  ~ ., data = data.training[, c(5,6,12,13,14,15,21,24,25,26,27,30,31,32,40)])


# Display Results
summary(lm.linear)
summary(lm.semi_log)
summary(lm.semi_log2)











# Assuming you have logCLV values in data.test$logCLV
real_logCLV <- data.test$logCLV

# Predicted values from the linear regression model lm.semi_log2
predicted_logCLV <- predict(lm.semi_log2, newdata = data.test)

# Create a data frame for plotting
plot_data <- data.frame(Real_LogCLV = real_logCLV, Predicted_LogCLV = predicted_logCLV)

# Calculate the breaks for the histograms
breaks <- seq(min(c(plot_data$Real_LogCLV, plot_data$Predicted_LogCLV)),
              max(c(plot_data$Real_LogCLV, plot_data$Predicted_LogCLV)),
              length.out = 30)  # Adjust the number of bins as needed

# Create a histogram for real log CLV in blue
hist(plot_data$Real_LogCLV, col = rgb(0, 0, 1, alpha = 0.4), main = "Histogram of Real LogCLV",
     xlab = "Real LogCLV", ylab = "Frequency", border = "white", xlim = range(breaks), breaks = breaks)

# Add histogram for predicted log CLV in green
hist(plot_data$Predicted_LogCLV, col = rgb(0, 1, 0, alpha = 0.4), add = TRUE, border = "white", breaks = breaks)

# Adding legend
legend("topright", legend = c("Real LogCLV", "Predicted LogCLV"), 
       fill = c(rgb(0, 0, 1, alpha = 0.4), rgb(0, 1, 0, alpha = 0.4)))

#produce residual vs. fitted plot
#get list of residuals 
res <- resid(lm.semi_log2)
plot(fitted(lm.semi_log2), res)

#add a horizontal line at 0 
abline(0,0)

#create Q-Q plot for residuals
qqnorm(res)

#add a straight diagonal line to the plot
qqline(res) 


```